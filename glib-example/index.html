<!DOCTYPE html>
<html>

<head>
<meta http-equiv="content-type" content="text/html; charset=ISO-8859-1"/>
<script type="text/javascript">

var oldstr = "";

function procTxtInput(event) {
    newstr = event.target.value;
    
    if (oldstr == newstr)
        return;
    
    lastchar = newstr.substr(newstr.length - 1);
    cont = document.getElementById("cbCont").checked;
    
    bslen = 0;
    var same = 0;
    for (; same < oldstr.length; same++)
        if (oldstr[same] != newstr[same])
            break;
    bslen = oldstr.length - same;
    
    bstxt = "";
    if (bslen > 0) {
        for (i = 0; i < bslen; i++)
            bstxt += String.fromCharCode(8);
    }
    
    diffstr = newstr.substr(same, newstr.length - same);
    
    console.log("bstxt: " + escape(bstxt) + ", diff: '" + escape(diffstr) + "'");
    
    if (cont) {
        printText(escape(bstxt + diffstr));
    }
    
    oldstr = newstr;
}

function clrTxt(event) {
    var txtip = document.getElementById("txtInput");
    txtip.value = "";
    txtip.focus();
}

function printText(txt) {
    var url = "http://192.168.4.1/display?command=print";
    var http = new XMLHttpRequest();
    http.open("POST", url, true);
    http.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
    http.send(txt);
    document.getElementById("plog").innerHTML = "sent: '" + txt + "'"
    console.log(txt);
}

</script>
</head>

<body>
<h1>Test page</h1>
<p><input type="checkbox" id="cbCont" onclick="clrTxt(event)" checked="true">continuous</p>
<textarea cols="40" rows="10" id="txtInput" oninput="procTxtInput(event)"></textarea>
<p id="plog"></p>
</body>


</html>
